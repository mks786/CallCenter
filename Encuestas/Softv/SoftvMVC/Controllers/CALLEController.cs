
using SoftvMVC.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using PagedList;
using Softv.Entities;
using Globals;
using System.Data.SqlClient;

namespace SoftvMVC.Controllers
{
    /// <summary>
    /// Class                   : SoftvMVC.Controllers.CALLEController.cs
    /// Generated by            : Class Generator (c) 2015
    /// Description             : CALLEController
    /// File                    : CALLEController.cs
    /// Creation date           : 20/05/2016
    /// Creation time           : 06:40 p. m.
    ///</summary>
    public partial class CALLEController : BaseController, IDisposable
    {
        private SoftvService.CALLEClient proxy = null;

        public CALLEController()
        {


            proxy = new SoftvService.CALLEClient();

        }

        new public void Dispose()
        {
            if (proxy != null)
            {
                if (proxy.State != System.ServiceModel.CommunicationState.Closed)
                {
                    proxy.Close();
                }
            }

        }



        public ActionResult GetCalleByColonia(int colonia, int plaza)
        {
            ConexionController c = new ConexionController();
            SqlCommand comandoSql;

            List<CALLEEntity> lista = new List<CALLEEntity>();
            SqlConnection conexionSQL = new SqlConnection(c.DameConexion(plaza));
            try
            {
                conexionSQL.Open();
            }
            catch
            { }
            comandoSql = new SqlCommand("select x3.Clv_Calle,x3.Nombre,x2.Clv_Colonia from CVECAROL x1 join COLONIAS x2 on x1.Clv_Colonia=x2.Clv_Colonia   join CALLES x3 on x3.Clv_Calle=x1.Clv_Calle where x2.Clv_Colonia=" + colonia + " order by x3.Nombre");
            comandoSql.Connection = conexionSQL;
            SqlDataReader reader = comandoSql.ExecuteReader();
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    CALLEEntity calle = new CALLEEntity();
                    calle.Clv_Calle = Int32.Parse(reader[0].ToString());
                    calle.Nombre = reader[1].ToString();
                    lista.Add(calle);
                }
            }


            return Json(lista, JsonRequestBehavior.AllowGet);
        }


    }

}

